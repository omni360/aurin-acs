# See http://docs.travis-ci.com/user/languages/javascript-with-nodejs/
language: java
jdk: oraclejdk8
sudo: required
services: docker
install: true
script: mvn clean test
after_success:
  - mvn site
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=urbanetic/aurin-acs
  - export VERSION=$(mvn -o org.apache.maven.plugins:maven-help-plugin:2.1.1:evaluate -Dexpression=project.version | grep -v '\[')
  - export TAGS=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest $VERSION"; else echo $TRAVIS_BRANCH ; fi`
  - mvn package docker:build -DskipTests -DpushImageTags $(printf " -DdockerImageTag=%s" $TAGS)

# Deploy JavaDocs to S3 static site.
# See http://docs.travis-ci.com/user/deployment/s3/
deploy:
  provider: s3
  # Access key is the public key.
  access_key_id: AKIAJCBJHLNERAVXIURA
  # Secret access key is the private key, encrypted for Travis.
  secret_access_key:
    secure: X5NDAzi8AoIPIgZ5GeFScuVQzHzX88iyvLpxGWbUmfqyR8o0n/4dCciuWMiEI4LnHXox9QiFf/L1/p6nYjf8pUSjqLWsQDWw+1HWjhNQ7f6mRnG2X9DFEq/qtOL40iGVt0+HewJaCBYUZMDFoXVdGdiTVPydJioMH7wU4J2QsR0=
  bucket: javadocs.acs.urbanetic.net
  endpoint: javadocs.acs.urbanetic.net.s3-website-ap-southeast-2.amazonaws.com
  region: ap-southeast-2
  local-dir: target/site/apidocs
  skip_cleanup: true
  on:
    all_branches: true
#    tags: true


after_success:
  - npm run docs

env:
  global:
    - secure: Khzo2xwOnc5HXwmqFnjMQmlhIdFvb/5MbVMdhd3cWSu/K+izyjS4WVCT+WVnoHPmFSLqKlnxvz2AGs3TFeaWuJO1gM4mZHpkTHfKJNgn58JkgEGUlU9xmfBEiBwZ0rFDhTV2llPEMIYaryv/mbsUjEBvqY0krJGbf3Xm4pWIc/Q=
    - secure: S0l5lJhxwX2VKYNUrRydnroJeFpTrxVl6x797jG8NEs5HDs/yWChyBINsN9y20/oAVDL04M1snP/EHr4CGnF0mrEWYlFSrMOii0qSqDD3pL8S3OEUPOB/ZsoQbmkV71GryvZ+3L0B4Uoseu2iLC58CnvhqX+jvQ6RsWFTX3p3Dw=
    - secure: dHaZMxgyQw2M39gnet6QKO21GLQMIFQHZx/xKymMDs1EzP+2KSaP2j9WufeffpWvheAwqOgH19xhJRi5RGV/pOLZADJbsitjcS3SMfX+diy9DBU1cSOB++ypSn8mbtcIQZOw0BDBXQgIbbyUfGKOfMrPDx2vFu52GMp+CxY2R0o=
    - COMMIT=${TRAVIS_COMMIT::8}
